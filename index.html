<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æˆå°±æ—¥å¿— Â· Arcade Editionï¼ˆåˆ é™¤ä¿®å¤&å›¾æ ‡å‡çº§ï¼‰</title>
<style>
:root{
  --bg:#0a0f1f; --bg2:#0d1226; --card:#0f142b; --card-2:#141b36;
  --text:#e8ecff; --muted:#9aa4c7; --border:#1d254a;
  --accent:#6ee7b7; --accent-2:#34d399; --danger:#f43f5e;
  --danger-soft:#fca5a5; --btn-bg:#0a112b;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--text);background:radial-gradient(1200px 600px at 10% -10%,#0b1330 0%,var(--bg) 50%,#050814 100%);font:16px/1.55 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Helvetica Neue",Arial;overflow-x:hidden}
.stars,.twinkle,.scan{position:fixed;inset:0;pointer-events:none;z-index:0}
.stars{background:
 radial-gradient(1px 1px at 20% 30%,#fff8 60%,transparent 61%),
 radial-gradient(1px 1px at 80% 20%,#fff6 60%,transparent 61%),
 radial-gradient(1px 1px at 40% 80%,#fff5 60%,transparent 61%),
 radial-gradient(1px 1px at 65% 60%,#fff7 60%,transparent 61%),
 radial-gradient(1px 1px at 10% 70%,#fff6 60%,transparent 61%);opacity:.25;animation:drift 40s linear infinite}
.twinkle{background:
 radial-gradient(2px 2px at 30% 40%,#fff 50%,transparent 51%),
 radial-gradient(2px 2px at 75% 70%,#fff 50%,transparent 51%),
 radial-gradient(2px 2px at 55% 20%,#fff 50%,transparent 51%);mix-blend-mode:screen;opacity:.08;animation:twinkle 2.6s ease-in-out infinite}
.scan{background:linear-gradient(transparent 90%,#fff2 95%,transparent);background-size:100% 8px;opacity:.06;animation:scan 12s linear infinite}
@keyframes drift{to{transform:translateY(30px)}} @keyframes twinkle{50%{opacity:.18}} @keyframes scan{to{background-position-y:8px}}
.wrap{position:relative;z-index:1;max-width:980px;margin:40px auto;padding:0 18px}
.panel{background:linear-gradient(180deg,var(--card) 0%,var(--card-2) 100%);border:1px solid var(--border);border-radius:18px;box-shadow:0 20px 60px #0008,inset 0 1px 0 #ffffff10;overflow:hidden}

/* å¤´éƒ¨ */
header{display:flex;align-items:center;gap:14px;padding:16px 18px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0e1735 0%,#0b122b 100%)}
.logo{width:34px;height:34px;border-radius:10px;display:grid;place-items:center;background:conic-gradient(from 220deg,#22c55e,#34d399,#22c55e);box-shadow:0 6px 20px #22c55e33}
header h1{font-size:18px;margin:0} header .muted{color:var(--muted);font-size:13px}

/* ç»Ÿè®¡/ç­‰çº§ */
.stats{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--border);background:#0c1431cc}
.kpis{display:flex;gap:10px;flex-wrap:wrap}
.kpi{background:#0b1230;border:1px solid var(--border);padding:8px 10px;border-radius:12px;min-width:120px}
.kpi .label{font-size:12px;color:var(--muted)} .kpi .val{font-size:18px;font-weight:800}
.level{display:flex;align-items:center;gap:10px;min-width:260px;flex:1}
.progress{position:relative;height:12px;background:#0a1130;border:1px solid var(--border);border-radius:999px;overflow:hidden;flex:1}
.progress>i{position:absolute;inset:0;width:0%;background:linear-gradient(90deg,#34d399,#22c55e);box-shadow:0 0 20px #34d39966;transition:width .45s ease}
.level .tag{background:#172042;padding:6px 10px;border:1px solid var(--border);border-radius:10px;font-weight:800}

/* è¾“å…¥åŒº */
.composer{padding:16px 18px;display:grid;grid-template-columns:1fr 160px 140px auto;gap:10px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0c1536,#0b1430)}
textarea{resize:vertical;min-height:56px;max-height:220px;background:#090f26;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px 14px;outline:none;box-shadow:inset 0 0 0 1px #0006}
textarea:focus{border-color:#2b356f;box-shadow:0 0 0 3px #34d39922}
select,input[type="text"]{background:#0a112b;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px 10px;outline:none}
button{border:0;background:linear-gradient(180deg,#34d399,#22c55e);color:#052e16;font-weight:800;padding:12px 16px;border-radius:12px;cursor:pointer;box-shadow:0 8px 20px #22c55e33}
button:disabled{opacity:.6;cursor:not-allowed}
.btn-secondary{background:var(--btn-bg);color:var(--text);border:1px solid var(--border);box-shadow:none}
.btn-danger{background:linear-gradient(180deg,#fb7185,#f43f5e);color:#fff}

/* å·¥å…·æ¡ */
.toolbar{padding:12px 18px;display:flex;gap:10px;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:#0a1231cc}
.toolbar .left,.toolbar .right{display:flex;gap:10px;align-items:center}

/* åˆ—è¡¨&å¡ç‰‡ */
.list{padding:10px 10px 18px}
.item{display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:start;background:linear-gradient(180deg,#0b1230,#0d1536);border:1px solid var(--border);border-radius:16px;padding:12px;margin:12px;position:relative;overflow:hidden;transition:transform .18s ease,box-shadow .18s ease,background .3s ease}
.item::after{content:"";position:absolute;inset:-1px;border-radius:16px;background:linear-gradient(90deg,transparent,#34d39922,transparent);opacity:0;transition:opacity .2s ease;pointer-events:none;} /* å…³é”®ä¿®å¤ */
.item:hover{transform:translateY(-2px);box-shadow:0 10px 28px #0007}
.item:hover::after{opacity:1}
.badge{width:44px;height:44px;border-radius:12px;display:grid;place-items:center;font-weight:900;font-size:14px;color:#061a12;background:conic-gradient(from 220deg,#6ee7b7,#34d399,#6ee7b7);box-shadow:0 8px 20px #22c55e33}
.icon{position:absolute;left:8px;top:8px;transform:translate(-8px,-6px) rotate(-15deg);font-size:36px;opacity:.2;pointer-events:none}
.content{display:flex;flex-direction:column;gap:6px}
.title{white-space:pre-wrap;word-break:break-word;font-size:16px}
.meta{font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#111a3b;color:#bcd1ff}
.tag.rare{background:#0b1a3f;color:#b5d5ff;border-color:#1e3a8a}
.tag.epic{background:#29114a;color:#e9d5ff;border-color:#6d28d9}
.tag.legend{background:#3a2505;color:#ffe8b0;border-color:#b45309}

/* åƒåœ¾æ¡¶æŒ‰é’®ï¼ˆå‡çº§ï¼‰ */
.actions{display:flex;gap:6px}
.icon-btn{background:var(--btn-bg);color:var(--text);border:1px solid var(--border);padding:8px;border-radius:12px;cursor:pointer;width:42px;height:42px;display:grid;place-items:center;transition:transform .12s ease, box-shadow .12s ease, background .12s ease}
.icon-btn.trash:hover{transform:translateY(-1px) rotate(-2deg);background:rgba(244,63,94,.08);box-shadow:0 6px 16px rgba(244,63,94,.2)}
.icon-btn.trash svg,.icon-btn.trash svg *{pointer-events:none}
.icon-btn.trash svg{transition:transform .15s ease, filter .15s ease}
.icon-btn.trash:hover svg{transform:rotate(-6deg);filter:drop-shadow(0 0 8px rgba(244,63,94,.5))}
.slide-out{animation:slide .28s ease forwards}
@keyframes slide{to{transform:translateX(12px);opacity:0}}

/* ç©º&è„šæ³¨ */
.empty{color:var(--muted);text-align:center;padding:32px 18px 40px}
footer{padding:12px 16px 18px;color:var(--muted);font-size:12px;text-align:center}

/* å“åº”å¼ */
@media (max-width:720px){.composer{grid-template-columns:1fr auto auto auto}}
@media (max-width:540px){.composer{grid-template-columns:1fr auto}#rarity,#iconInput{display:none}}
</style>
</head>
<body>
  <div class="stars"></div><div class="twinkle"></div><div class="scan"></div>

  <div class="wrap">
    <div class="panel">
      <header>
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 2l2.3 4.6L20 8l-4 3.8.9 5.9L12 15.3 7.1 17.7 8 11.8 4 8l5.7-1.4L12 2z" fill="#0b3b2a"/><path d="M12 3.2l1.9 3.9 4.3.9-3.2 3 .7 4.6L12 13.6l-3.7 2 .7-4.6-3.2-3 4.3-.9L12 3.2z" fill="#c7f9e9"/></svg>
        </div>
        <h1>æˆå°±è®°å½•æœ¬ Â· Arcade Edition</h1>
        <span class="muted">æ•°æ®ä»…ä¿å­˜åœ¨æœ¬æœºæµè§ˆå™¨</span>
      </header>

      <section class="stats">
        <div class="kpis">
          <div class="kpi"><div class="label">æˆå°±æ€»æ•°</div><div class="val" id="total">0</div></div>
          <div class="kpi"><div class="label">è¿å‡»å¤©æ•°</div><div class="val" id="streak">0 ğŸ”¥</div></div>
        </div>
        <div class="level">
          <div class="tag" id="levelTag">Lv.1 æ–°æ‰‹</div>
          <div class="progress" aria-label="å‡çº§è¿›åº¦"><i id="progressBar" style="width:0%"></i></div>
        </div>
      </section>

      <section class="composer">
        <textarea id="input" placeholder="å†™ä¸‹ä¸€ä¸ªæˆå°±â€¦ï¼ˆEnter æ·»åŠ ï¼ŒShift+Enter æ¢è¡Œï¼ŒCtrl/Cmd+Enter ä¹Ÿå¯ï¼‰"></textarea>
        <select id="rarity" title="ç¨€æœ‰åº¦">
          <option value="common">æ™®é€š</option><option value="rare">ç¨€æœ‰</option>
          <option value="epic">å²è¯—</option><option value="legend">ä¼ è¯´</option>
        </select>
        <input id="iconInput" type="text" maxlength="2" placeholder="ğŸ¯ å›¾æ ‡(å¯é€‰)" title="å¡«ä¸€ä¸ªè¡¨æƒ…ä½œä¸ºæˆå°±å›¾æ ‡ï¼Œå¦‚ ğŸ† / ğŸ® / â­">
        <button id="addBtn" type="button" title="æ·»åŠ æˆå°±">+ æ·»åŠ </button>
      </section>

      <div class="toolbar">
        <div class="left">
          <button class="btn-secondary" id="exportBtn" type="button" title="å¯¼å‡ºä¸º JSON">å¯¼å‡º</button>
          <label class="btn-secondary" for="importFile" title="ä» JSON å¯¼å…¥">å¯¼å…¥</label>
          <input id="importFile" type="file" accept="application/json" hidden>
          <select class="btn-secondary" id="filter" title="è¿‡æ»¤">
            <option value="all">æ˜¾ç¤ºï¼šå…¨éƒ¨</option>
            <option value="common">ä»…æ™®é€š</option>
            <option value="rare">ä»…ç¨€æœ‰</option>
            <option value="epic">ä»…å²è¯—</option>
            <option value="legend">ä»…ä¼ è¯´</option>
          </select>
          <label class="btn-secondary" style="display:flex;align-items:center;gap:6px;padding:8px 10px;border-radius:12px;cursor:pointer">
            <input id="soundToggle" type="checkbox" style="accent-color:#22c55e"> ğŸ”Š éŸ³æ•ˆ
          </label>
        </div>
        <div class="right">
          <button class="btn-secondary btn-danger" id="clearBtn" type="button" title="æ¸…ç©ºå…¨éƒ¨">æ¸…ç©º</button>
        </div>
      </div>

      <section id="list" class="list"></section>
      <footer>æç¤ºï¼šç‚¹å‡»åƒåœ¾æ¡¶å¯åˆ é™¤ï¼›æ·»åŠ æ—¶æœ‰å½©å¸¦åº†ç¥ï¼ˆé»˜è®¤é™éŸ³ï¼Œå¯åœ¨å·¥å…·æ å¼€å¯ï¼‰ã€‚æ•°æ®ä¿å­˜åœ¨ <code>localStorage</code>ã€‚</footer>
    </div>
  </div>

  <canvas id="confetti" style="position:fixed;inset:0;pointer-events:none;z-index:2;"></canvas>

<script>
(function(){
  function $(s,root){return (root||document).querySelector(s)}
  function genId(){return String(Date.now())+'-'+Math.random().toString(36).slice(2,8)}
  function clamp(n,min,max){return n<min?min:(n>max?max:n)}

  var input=$('#input'), raritySel=$('#rarity'), iconInput=$('#iconInput'),
      addBtn=$('#addBtn'), listEl=$('#list'), clearBtn=$('#clearBtn'),
      exportBtn=$('#exportBtn'), importFile=$('#importFile'), filterSel=$('#filter'),
      totalEl=$('#total'), streakEl=$('#streak'), progressBar=$('#progressBar'),
      levelTag=$('#levelTag'), confettiCanvas=$('#confetti'), soundToggle=$('#soundToggle');

  var KEY='achievements.v3', LEG1='achievements.v2', LEG0='achievements.v1', KEY_SOUND='achievements.sound';

  var items = loadAll();
  var filter = 'all';
  var soundOn = (localStorage.getItem(KEY_SOUND)||'0') === '1';
  soundToggle.checked = soundOn;

  /* ============ æ¸²æŸ“ ============ */
  function render(){
    listEl.innerHTML='';
    var show = items.filter(function(it){return filter==='all' ? true : it.rarity===filter});
    if(!show.length){
      var empty=document.createElement('div'); empty.className='empty';
      empty.textContent='è¿˜æ²¡æœ‰æˆå°±ï¼Œå†™ä¸‹ç¬¬ä¸€æ¡å§ï¼'; listEl.appendChild(empty);
    }else{
      for(var i=0;i<show.length;i++){
        var it=show[i];
        var li=document.createElement('div'); li.className='item'; li.setAttribute('data-id',it.id);

        var badge=document.createElement('div'); badge.className='badge';
        badge.textContent=String(items.indexOf(it)+1);

        var content=document.createElement('div'); content.className='content';
        var title=document.createElement('div'); title.className='title'; title.textContent=it.text;
        var meta=document.createElement('div'); meta.className='meta';
        var t=document.createElement('span'); t.textContent=formatTime(it.createdAt);
        var r=document.createElement('span'); r.className='tag '+rarityClass(it.rarity); r.textContent=rarityLabel(it.rarity);
        meta.appendChild(t); meta.appendChild(r);
        content.appendChild(title); content.appendChild(meta);

        var actions=document.createElement('div'); actions.className='actions';
        var del=document.createElement('button');
        del.className='icon-btn trash'; del.type='button';
        del.setAttribute('data-action','del'); del.setAttribute('data-id', it.id);
        del.setAttribute('aria-label','åˆ é™¤è¯¥æˆå°±');
        del.innerHTML = trashIconUpgraded();
        actions.appendChild(del);

        if(it.icon){
          var icon=document.createElement('div'); icon.className='icon'; icon.textContent=it.icon; li.appendChild(icon);
        }

        li.appendChild(badge); li.appendChild(content); li.appendChild(actions);
        listEl.appendChild(li);
      }
    }
    totalEl.textContent=String(items.length);
    streakEl.textContent = calcStreak(items)+' ğŸ”¥';
    updateLevel();
  }

  /* ============ ç­‰çº§ ============ */
  function updateLevel(){
    var lvl=Math.floor(items.length/5)+1; var inLevel=items.length%5;
    var pct=clamp(inLevel/5*100,0,100);
    progressBar.style.width=pct+'%';
    levelTag.textContent='Lv.'+lvl+' '+levelName(lvl);
  }
  function levelName(l){return l<3?'æ–°æ‰‹':(l<6?'å†’é™©è€…':(l<9?'å‹‡è€…':(l<12?'å²è¯—çŒäºº':'ä¼ è¯´ç¼”é€ è€…')))}

  /* ============ æ·»åŠ  ============ */
  function add(text,rarity,icon){
    var raw = (typeof text==='string'? text : (input && input.value) || '');
    var t = raw.replace(/^\s+|\s+$/g,'');
    if(!t) return;
    var item={ id:genId(), text:t, rarity: validRarity(rarity|| (raritySel?raritySel.value:'') ) ? (rarity||raritySel.value) : 'common',
               icon: (typeof icon==='string'?icon:(iconInput?iconInput.value:'')) || '', createdAt: Date.now() };
    items.push(item); saveAll(); render(); try{confetti()}catch(e){} blip();
    if(input){ input.value=''; input.focus() } if(iconInput){ iconInput.value='' }
  }

  /* ============ åˆ é™¤ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰ ============ */
  function removeById(id, node){
    var idx = -1; for(var i=0;i<items.length;i++){ if(String(items[i].id)===String(id)){ idx=i; break; } }
    if(idx===-1) return;
    try{ if(node && node.classList) node.classList.add('slide-out') }catch(e){}
    setTimeout(function(){ items.splice(idx,1); saveAll(); render() }, 200);
  }

  listEl.addEventListener('click', function(e){
    var btn = e.target.closest ? e.target.closest('[data-action="del"],button.icon-btn.trash') : null;
    if(!btn || !listEl.contains(btn)) return;
    var id = btn.getAttribute('data-id');
    var li = btn.closest('.item');
    removeById(id, li);
  }, false);

  /* ============ å·¥å…· ============ */
  function saveAll(){ try{ localStorage.setItem(KEY, JSON.stringify(items)) }catch(e){} }
  function loadAll(){
    try{
      var raw=localStorage.getItem(KEY); if(raw){ var arr=JSON.parse(raw); if(arr && arr.constructor===Array) return arr }
      var r2=localStorage.getItem(LEG1); if(r2){ var a2=JSON.parse(r2); if(a2 && a2.constructor===Array){ localStorage.setItem(KEY,JSON.stringify(a2)); return a2 } }
      var r1=localStorage.getItem(LEG0); if(r1){ var a1=JSON.parse(r1); if(a1 && a1.constructor===Array){
        var migrated=a1.map(function(x){return {id:String(x.id||genId()),text:String(x.text||''),createdAt:Number(x.createdAt||Date.now()),rarity:'common',icon:''}});
        localStorage.setItem(KEY,JSON.stringify(migrated)); return migrated;
      } }
    }catch(e){}
    return [];
  }
  function formatTime(ms){
    try{
      var d=new Date(ms);
      var y=d.getFullYear(), m=('0'+(d.getMonth()+1)).slice(-2), dd=('0'+d.getDate()).slice(-2);
      var hh=('0'+d.getHours()).slice(-2), mm=('0'+d.getMinutes()).slice(-2), ss=('0'+d.getSeconds()).slice(-2);
      return 'è®°å½•æ—¶é—´ï¼š'+(y+'-'+m+'-'+dd+' '+hh+':'+mm+':'+ss);
    }catch(e){ return 'è®°å½•æ—¶é—´ï¼š'+new Date().toLocaleString() }
  }
  function rarityLabel(r){ return r==='legend'?'ä¼ è¯´':(r==='epic'?'å²è¯—':(r==='rare'?'ç¨€æœ‰':'æ™®é€š')) }
  function rarityClass(r){ return r==='legend'?'legend':(r==='epic'?'epic':(r==='rare'?'rare':'')) }
  function validRarity(r){ return r==='common'||r==='rare'||r==='epic'||r==='legend' }

  function trashIconUpgraded(){
    return (
      '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true" role="img">'+
        '<path d="M9 6v-1.2A1.8 1.8 0 0 1 10.8 3h2.4A1.8 1.8 0 0 1 15 4.8V6" stroke="#fca5a5" stroke-width="1.6" stroke-linecap="round"/>'+
        '<path d="M3 6h18" stroke="#fca5a5" stroke-width="1.6" stroke-linecap="round"/>'+
        '<rect x="6.8" y="6.8" width="10.4" height="13.4" rx="2.2" stroke="#e5e7eb" stroke-width="1.6" fill="url(#g1)"/>'+
        '<path d="M10 10.2v7M14 10.2v7" stroke="#f87171" stroke-width="1.6" stroke-linecap="round"/>'+
        '<defs><linearGradient id="g1" x1="12" y1="6.8" x2="12" y2="20.2" gradientUnits="userSpaceOnUse">'+
        '<stop stop-color="#0f172a"/><stop offset="1" stop-color="#111827"/></linearGradient></defs>'+
      '</svg>'
    );
  }

  /* ============ streak / confetti / éŸ³æ•ˆ ============ */
  function calcStreak(arr){
    if(!arr.length) return 0;
    var days={}; for(var i=0;i<arr.length;i++){ days[new Date(arr[i].createdAt).toDateString()]=true }
    var streak=0, cursor=new Date();
    while(days[cursor.toDateString()]){ streak++; cursor.setDate(cursor.getDate()-1) }
    if(streak===0){ cursor=new Date(); cursor.setDate(cursor.getDate()-1); while(days[cursor.toDateString()]){streak++; cursor.setDate(cursor.getDate()-1)} }
    return streak;
  }
  function confetti(){
    var ctx=confettiCanvas && confettiCanvas.getContext? confettiCanvas.getContext('2d'):null; if(!ctx) return;
    var W=confettiCanvas.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;
    var H=confettiCanvas.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;
    var N=100, parts=[]; for(var i=0;i<N;i++){ parts.push({x:Math.random()*W,y:-20-Math.random()*60,r:4+Math.random()*6,c:randColor(),v:2+Math.random()*3,w:Math.random()*2-1}) }
    var t=0, raf; (function draw(){ t++; var ctx2=ctx; ctx2.clearRect(0,0,W,H);
      for(var i=0;i<parts.length;i++){ var p=parts[i]; p.y+=p.v; p.x+=p.w; p.w+= (Math.random()-.5)*.05;
        ctx2.save(); ctx2.translate(p.x,p.y); ctx2.rotate((t+p.x)*.02); ctx2.fillStyle=p.c; ctx2.fillRect(-p.r/2,-p.r/2,p.r,p.r); ctx2.restore();
      }
      if(t<120) raf=requestAnimationFrame(draw); else { cancelAnimationFrame(raf); ctx2.clearRect(0,0,W,H) }
    })();
    function randColor(){ var cols=['#34d399','#60a5fa','#f472b6','#f59e0b','#a78bfa','#fb7185','#22d3ee']; return cols[(Math.random()*cols.length)|0] }
  }
  function blip(){
    if(!soundOn) return;
    try{
      var AC=window.AudioContext||window.webkitAudioContext; if(!AC) return;
      var ctx=new AC(), o=ctx.createOscillator(), g=ctx.createGain();
      o.type='triangle'; o.frequency.setValueAtTime(660,ctx.currentTime); o.frequency.exponentialRampToValueAtTime(1320,ctx.currentTime+0.08);
      g.gain.setValueAtTime(0.0001,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.2,ctx.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+0.14);
      o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.16);
    }catch(e){}
  }

  /* ============ äº‹ä»¶ç»‘å®š ============ */
  addBtn && addBtn.addEventListener('click', function(){ add() });
  input && input.addEventListener('keydown', function(e){
    var key=e.key||e.keyCode; var isEnter = key==='Enter' || key===13; var ctrl = e.ctrlKey || e.metaKey;
    if(isEnter && (!e.shiftKey || ctrl)){ e.preventDefault(); add(); }
  });
  clearBtn && clearBtn.addEventListener('click', function(){
    if(!items.length) return;
    if(confirm('ç¡®å®šè¦æ¸…ç©ºå…¨éƒ¨æˆå°±å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')){ items=[]; saveAll(); render(); }
  });
  exportBtn && exportBtn.addEventListener('click', function(){
    try{
      var blob=new Blob([JSON.stringify(items,null,2)],{type:'application/json;charset=utf-8'});
      var url=URL.createObjectURL(blob); var a=document.createElement('a');
      a.href=url; a.download='achievements-'+new Date().toISOString().slice(0,10)+'.json'; a.click(); URL.revokeObjectURL(url);
    }catch(e){ alert('å¯¼å‡ºå¤±è´¥ï¼š'+e.message) }
  });
  importFile && importFile.addEventListener('change', function(e){
    var f=(e.target.files && e.target.files[0]) || null;
    if(f){
      var reader=new FileReader();
      reader.onload=function(ev){
        try{
          var data=JSON.parse(String(ev.target.result));
          if(!(data && data.constructor===Array)) throw new Error('æ ¼å¼ä¸æ­£ç¡®');
          items = data.map(function(x){
            return { id: String(x.id||genId()), text: String(x.text||''), createdAt: Number(x.createdAt||Date.now()),
                     rarity: (x.rarity==='common'||x.rarity==='rare'||x.rarity==='epic'||x.rarity==='legend')?x.rarity:'common', icon: String(x.icon||'') }
          }).filter(function(x){ return x.text.replace(/^\s+|\s+$/g,'') });
          saveAll(); render(); alert('å¯¼å…¥å®Œæˆ');
        }catch(err){ alert('å¯¼å…¥å¤±è´¥ï¼š'+err.message) }
      };
      reader.readAsText(f,'utf-8');
    }
    importFile.value='';
  });
  filterSel && filterSel.addEventListener('change', function(){
    filter = filterSel.value || 'all';
    render();
  });
  soundToggle && soundToggle.addEventListener('change', function(){
    soundOn = !!soundToggle.checked; try{ localStorage.setItem(KEY_SOUND, soundOn?'1':'0') }catch(e){}
  });

  /* åˆå§‹æ¸²æŸ“ */
  render();
})();
</script>
</body>
</html>
